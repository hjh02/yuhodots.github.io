{"componentChunkName":"component---src-templates-post-js","path":"/backend/2019-07-02/","result":{"data":{"markdownRemark":{"html":"<blockquote>\n<p>이 글은 ‘오픈튜토리얼스-생활코딩’의 Egoing님의 <a href=\"https://opentutorials.org/course/3402/21869\">강의</a>를 정리했음을 먼저 밝힙니다.</p>\n</blockquote>\n<p> 로그인과 같은 인증 기능을 구현하기 위해서 우리가 직접 인증을 구현하는 것이 아니라 다른 개발 회사들이 구현한 인증방법을 우리가 빌려 사용 할 수 있습니다. 이 때 필요한 것이 passport.js입니다. 물론 이외에도 더 다양한 미들웨어가 존재하지만 passport.js가 가장 보편적으로 사용되는 미들웨어이기 때문에 이에 대해 공부해보도록 하겠습니다. </p>\n<h3 id=\"passportjs-설치\" style=\"position:relative;\"><a href=\"#passportjs-%EC%84%A4%EC%B9%98\" aria-label=\"passportjs 설치 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>passport.js 설치</h3>\n<p> passport.js는 우리가 로그인 방법을 확장해 나가는 방법들을 strategies(전략)이라는 단어로 구분짓습니다. 300가지 정도 되는 다양한 전략들이 있지만 일단은 아이디와 비밀번호를 통해서 로그인 및 회원가입을 진행하는 전통적 방식의 인증을 passport를 통해 구현해 보는것을 우선으로 공부 할 예정입니다. </p>\n<ul>\n<li>passport 설치 방법: 터미널에서 <code class=\"language-text\">npm install passport</code> 명령어 입력</li>\n<li>전통적 방식 로그인 구현: 터미널에서 <code class=\"language-text\">npm install passport-local</code> 명령어 입력</li>\n<li>기본 형태: <a href=\"http://www.passportjs.org/packages/passport-local/\">http://www.passportjs.org/packages/passport-local/</a></li>\n</ul>\n<p>일단은 위의 세가지 작업을 모두 완료하였다면 기본적인 passport사용을 위한 설치는 마친 것 입니다. 여기서 passport미들웨어는 session을 내부적으로 사용하기 때문에 반드시 <strong>express-session을 활성화 하는 코드의 아래</strong>에 위치해야 합니다. </p>\n<h3 id=\"passportjs-인증-구현\" style=\"position:relative;\"><a href=\"#passportjs-%EC%9D%B8%EC%A6%9D-%EA%B5%AC%ED%98%84\" aria-label=\"passportjs 인증 구현 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>passport.js 인증 구현</h3>\n<p> 로그인 UI에 정보를 입력하고 submit버튼을 눌렀을 때, 로그인 정보를 /login_process 라는 path로 전송한다고 가정을 해 봅시다. 그러면 우리는 이 path가 post방식으로 받는 정보에 대해서 passport.js 버전으로 코드를 수정해 주어야 합니다. </p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">var</span> passport <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'passport'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  LocalStrategy <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'passport-local'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>Strategy<span class=\"token punctuation\">;</span>\n\napp<span class=\"token punctuation\">.</span><span class=\"token function\">post</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/auth/login_process'</span><span class=\"token punctuation\">,</span>\n  passport<span class=\"token punctuation\">.</span><span class=\"token function\">authenticate</span><span class=\"token punctuation\">(</span><span class=\"token string\">'local'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n    successRedirect<span class=\"token operator\">:</span> <span class=\"token string\">'/'</span><span class=\"token punctuation\">,</span>\n    failureRedirect<span class=\"token operator\">:</span> <span class=\"token string\">'/auth/login'</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p> 코드 중 passport.js 관련 부분만 떼어서 가져와 보았습니다. 일단 passport 홈페이지를 참고하여 passport모듈을 알맞은 코드 형태로 로드해주었고, 그 아래에 post방식으로 로그인 정보를 전송하는 코드입니다. post방식으로 /auth/login_process 경로로 정보가 전송 되며, 로그인이 성공하면 / 경로인 홈으로 리다이렉트 되고 로그인이 실패하면 /auth/login 경로로 리다이렉트 되는 코드입니다. </p>\n<h3 id=\"passportjs-자격-확인\" style=\"position:relative;\"><a href=\"#passportjs-%EC%9E%90%EA%B2%A9-%ED%99%95%EC%9D%B8\" aria-label=\"passportjs 자격 확인 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Passport.js 자격 확인</h3>\n<p> 코드 중 중요한 부분만 따로 떼어 보았습니다. 완벽히 이해하기 보다는 대충 감을 익히기 위한 정도로만 설명을 하겠습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">router<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/login'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">request<span class=\"token punctuation\">,</span> response</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">var</span> title <span class=\"token operator\">=</span> <span class=\"token string\">'WEB - login'</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">var</span> list <span class=\"token operator\">=</span> template<span class=\"token punctuation\">.</span><span class=\"token function\">list</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">.</span>list<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">var</span> html <span class=\"token operator\">=</span> template<span class=\"token punctuation\">.</span><span class=\"token constant\">HTML</span><span class=\"token punctuation\">(</span>title<span class=\"token punctuation\">,</span> list<span class=\"token punctuation\">,</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\n    &lt;form action=\"/auth/login_process\" method=\"post\">\n      &lt;p>&lt;input type=\"text\" name=\"email\" placeholder=\"email\">&lt;/p>\n      &lt;p>&lt;input type=\"password\" name=\"pwd\" placeholder=\"password\">&lt;/p>\n      &lt;p>\n        &lt;input type=\"submit\" value=\"login\">\n      &lt;/p>\n    &lt;/form>\n  </span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span> <span class=\"token string\">''</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  response<span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span>html<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p> 위의 코드에서 저는 HTML form의 ID값의 이름은 email, 비밀번호 값의 이름은 pwd로 정보를 전송하고 있습니다. <a href=\"http://www.passportjs.org/packages/passport-local/\">이 곳</a>에서 참고하여 작성한 로그인을 위한 자격확인 코드는 아래와 같습니다. </p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">var</span> passport <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'passport'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  LocalStrategy <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'passport-local'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>Strategy<span class=\"token punctuation\">;</span>\n\npassport<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">LocalStrategy</span><span class=\"token punctuation\">(</span>\n  <span class=\"token punctuation\">{</span>\n    usernameField<span class=\"token operator\">:</span> <span class=\"token string\">'email'</span><span class=\"token punctuation\">,</span>\n    passwordField<span class=\"token operator\">:</span> <span class=\"token string\">'pwd'</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">username<span class=\"token punctuation\">,</span> password<span class=\"token punctuation\">,</span> done</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'LocalStrategy'</span><span class=\"token punctuation\">,</span> username<span class=\"token punctuation\">,</span> password<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p><code class=\"language-text\">passport.use(new LocalStrategy(...))</code> 함수의 첫 번째 인자로는 ID와 비밀번호 정보의 이름을 <strong>객체</strong>의 형태로 전달해 주고 그 다음 인자 부터는 콜백함수를 주는 형태입니다. 저는 각각 email, pwd라는 이름으로 form을 전송했으니 그와 동일하게 객체를 선언하였습니다. 그럼 여기서 코드를 좀 더 추가하겠습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">passport<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">LocalStrategy</span><span class=\"token punctuation\">(</span>\n  <span class=\"token punctuation\">{</span>\n    usernameField<span class=\"token operator\">:</span> <span class=\"token string\">'email'</span><span class=\"token punctuation\">,</span>\n    passwordField<span class=\"token operator\">:</span> <span class=\"token string\">'pwd'</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">username<span class=\"token punctuation\">,</span> password<span class=\"token punctuation\">,</span> done</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'LocalStrategy'</span><span class=\"token punctuation\">,</span> username<span class=\"token punctuation\">,</span> password<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>username <span class=\"token operator\">===</span> authData<span class=\"token punctuation\">.</span>email<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>password <span class=\"token operator\">===</span> authData<span class=\"token punctuation\">.</span>password<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token function\">done</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> authData<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token function\">done</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n          message<span class=\"token operator\">:</span> <span class=\"token string\">'Incorrect password.'</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">return</span> <span class=\"token function\">done</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n        message<span class=\"token operator\">:</span> <span class=\"token string\">'Incorrect username.'</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p> 이번에도 passport.js 홈페이지의 local에 대한 strategy 글을 참고한 코드입니다. (저는 이고잉님의 코드를 참고하였습니다.) 기본적으로는 아래의 두가지만 기억을 하면 됩니다. </p>\n<ol>\n<li>로그인 정보 일치시: <strong>done(null, 유저정보)</strong> 를 리턴</li>\n<li>로그인 정보 불일치시: <strong>done(null, false, 틀린 이유 메세지)</strong> 를 리턴</li>\n</ol>\n<p> 이를바탕으로 위의 코드를 해석해 보면 아래와 같습니다. </p>\n<ul>\n<li>console.log(1)의 경우: 유저의 아이디가 일치</li>\n<li>console.log(2)의 경우: 유저의 아이디가 일치, 패스워드가 일치</li>\n<li>console.log(3)의 경우: 유저의 아이디는 일치하지만, 패스워드는 불일치</li>\n<li>console.log(4)의 경우: 유저의 아이디가 불일치</li>\n</ul>\n<h3 id=\"passportjs-세션-이용\" style=\"position:relative;\"><a href=\"#passportjs-%EC%84%B8%EC%85%98-%EC%9D%B4%EC%9A%A9\" aria-label=\"passportjs 세션 이용 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Passport.js 세션 이용</h3>\n<p> pm2, nodemon과 같은 자동 재시작 도구를 사용하는 경우 세션 정보가 저장이 안되는 현상이 발생할 수 있습니다. session 디렉토리에 파일이 추가되면 node가 재시작 되기 때문입니다. 이를 해결하기 위해서 sessions 디렉토리에 대해서는 재시작을 하지 않도록 조치해야 합니다.</p>\n<p>이 문제를 해결하기 위해서는 main.js 파일을 실행 시킬 때 명령어를 <code class=\"language-text\">pm2 start main.js --watch --ignore-watch=&quot;data/* sessions/*&quot; --no-daemon</code> 이렇게 입력하시면 됩니다. data디렉토리와 sessions디렉토리에 대해서는 watch를 무시하겠다는 명령어 입니다. </p>\n<p> passport.js 는 내부적으로 express-session를 사용합니다. 이 두 개의 미들웨어를 연결하기 위해서 기본적으로 넣어줘야 하는 코드는 다음과 같습니다. </p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">app<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span>passport<span class=\"token punctuation\">.</span><span class=\"token function\">initialize</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\napp<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span>passport<span class=\"token punctuation\">.</span><span class=\"token function\">session</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p> 또한 위의 코드만 입력하면 '사용자에 대한 정보를 session으로 저장을 해야하는데, session에 대한 세팅이 되어있지 않다. serialize하라.' 대충 이런 내용의 오류 문구가 뜹니다. 이를 해결하기 위해서 아래와 같은 코드 또한 넣어줍시다.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">passport<span class=\"token punctuation\">.</span><span class=\"token function\">serializeUser</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">user<span class=\"token punctuation\">,</span> done</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'serializeUser'</span><span class=\"token punctuation\">,</span> user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">done</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> user<span class=\"token punctuation\">.</span>email<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\npassport<span class=\"token punctuation\">.</span><span class=\"token function\">deserializeUser</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">id<span class=\"token punctuation\">,</span> done</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'deserializeUser'</span><span class=\"token punctuation\">,</span> id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">done</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> authData<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ol>\n<li>passport.js에서는 우리가 로그인을 성공 했을 때 리턴해준 <code class=\"language-text\">done(null,authData)</code>의 authData값을 <code class=\"language-text\">passport.serializeUser</code>의 콜백함수의 첫 번째 인자(user)로 넘겨주기로 약속되어 있습니다. </li>\n<li><code class=\"language-text\">passport.serializeUse</code>함수의 콜백함수에서의 <code class=\"language-text\">done(null, user.email)</code>은 user.email에 대한 정보를 session데이터 내 passport로 전송합니다. 즉, 로그인에 성공했을 때 로그인에 성공했다는 정보를 session store에 저장하는 것이 serializeUser의 기능입니다. 그래서 로그인 성공시 딱 한번만 호출됩니다.</li>\n<li><code class=\"language-text\">passport.deserializeUser</code>함수는 페이지를 방문 할 때 마다 콜백함수를 실행시킵니다. 즉, 페이지를 방문할 때 마다 이 사람이 유효한 사용자인지 체크하는 것이 deserializeUser의 기능입니다. 그래서 이 함수는 웹 애플리케이션을 사용하는 동안 여러번 호출됩니다. </li>\n</ol>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 760px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/54694d0dd7918647c4a60cc7035f4c0c/21b4d/19-07-02-1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 13.684210526315791%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAbElEQVQI113OSwrAIAwEUA+iReMHPxtR8f43S8mAUrp4zECCUblA3HvnOScypcQ5Z/Des7UWiOj2P+cc5pIqlYyHxBgDaq13IYSAfvKQY0eMEWRHPWTxu7UW7725tcalFFzWWrMxBr79T2bHC5ycVTALBtW6AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/54694d0dd7918647c4a60cc7035f4c0c/15813/19-07-02-1.webp 190w,\n/static/54694d0dd7918647c4a60cc7035f4c0c/1cdb2/19-07-02-1.webp 380w,\n/static/54694d0dd7918647c4a60cc7035f4c0c/9046c/19-07-02-1.webp 760w,\n/static/54694d0dd7918647c4a60cc7035f4c0c/c89f9/19-07-02-1.webp 1140w,\n/static/54694d0dd7918647c4a60cc7035f4c0c/af3f0/19-07-02-1.webp 1280w\"\n              sizes=\"(max-width: 760px) 100vw, 760px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/54694d0dd7918647c4a60cc7035f4c0c/a2d4f/19-07-02-1.png 190w,\n/static/54694d0dd7918647c4a60cc7035f4c0c/3f520/19-07-02-1.png 380w,\n/static/54694d0dd7918647c4a60cc7035f4c0c/3c051/19-07-02-1.png 760w,\n/static/54694d0dd7918647c4a60cc7035f4c0c/b5cea/19-07-02-1.png 1140w,\n/static/54694d0dd7918647c4a60cc7035f4c0c/21b4d/19-07-02-1.png 1280w\"\n            sizes=\"(max-width: 760px) 100vw, 760px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/54694d0dd7918647c4a60cc7035f4c0c/3c051/19-07-02-1.png\"\n            alt=\"img\"\n            title=\"img\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<h3 id=\"총-정리\" style=\"position:relative;\"><a href=\"#%EC%B4%9D-%EC%A0%95%EB%A6%AC\" aria-label=\"총 정리 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>총 정리</h3>\n<p> 너무 길고 복잡한 내용이기 때문에 다시 한번 순서대로 정리해보겠습니다.</p>\n<ol>\n<li>passport모듈 설치, express에 passport설치, express-session을 passport내부적으로 사용하겠다고 선언 </li>\n<li>passport.authenticate함수를 통해 사용자가 입력한 정보를 passport가 local전략으로 받도록 선언</li>\n<li>passport.use함수에 LocalStrategy를 설치하고, passport.use함수의 콜백함수로 사용자의 아이디와 비밀번호 올바른지 확인, 이로인해서 done함수가 리턴됨</li>\n<li>done함수에 의해 serializeUser의 콜백함수 호출</li>\n<li>serializeUser의 콜백함수에 의해, 사용자의 식별자 값이 session store의 passport데이터로 저장됨</li>\n<li>웹 페이지를 옮겨다닐 때 마다 deserializeUser가 호출되어 인증된 사용자인지 확인</li>\n</ol>","tableOfContents":"<ul>\n<li><a href=\"/Web/19-07-02-Passport%EB%A5%BC%20%EC%82%AC%EC%9A%A9%ED%95%9C%20%EC%9D%B8%EC%A6%9D%20%EA%B8%B0%EB%8A%A5%20%EA%B5%AC%ED%98%84/#passportjs-%EC%84%A4%EC%B9%98\">passport.js 설치</a></li>\n<li><a href=\"/Web/19-07-02-Passport%EB%A5%BC%20%EC%82%AC%EC%9A%A9%ED%95%9C%20%EC%9D%B8%EC%A6%9D%20%EA%B8%B0%EB%8A%A5%20%EA%B5%AC%ED%98%84/#passportjs-%EC%9D%B8%EC%A6%9D-%EA%B5%AC%ED%98%84\">passport.js 인증 구현</a></li>\n<li><a href=\"/Web/19-07-02-Passport%EB%A5%BC%20%EC%82%AC%EC%9A%A9%ED%95%9C%20%EC%9D%B8%EC%A6%9D%20%EA%B8%B0%EB%8A%A5%20%EA%B5%AC%ED%98%84/#passportjs-%EC%9E%90%EA%B2%A9-%ED%99%95%EC%9D%B8\">Passport.js 자격 확인</a></li>\n<li><a href=\"/Web/19-07-02-Passport%EB%A5%BC%20%EC%82%AC%EC%9A%A9%ED%95%9C%20%EC%9D%B8%EC%A6%9D%20%EA%B8%B0%EB%8A%A5%20%EA%B5%AC%ED%98%84/#passportjs-%EC%84%B8%EC%85%98-%EC%9D%B4%EC%9A%A9\">Passport.js 세션 이용</a></li>\n<li><a href=\"/Web/19-07-02-Passport%EB%A5%BC%20%EC%82%AC%EC%9A%A9%ED%95%9C%20%EC%9D%B8%EC%A6%9D%20%EA%B8%B0%EB%8A%A5%20%EA%B5%AC%ED%98%84/#%EC%B4%9D-%EC%A0%95%EB%A6%AC\">총 정리</a></li>\n</ul>","frontmatter":{"path":"/backend/2019-07-02/","title":"Passport를 사용한 인증 기능 구현","category":"BackEnd","date":"2019-07-02"}}},"pageContext":{}},"staticQueryHashes":["2390655019","256249292","63159454"]}